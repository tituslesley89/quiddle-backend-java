package clients;

import com.fasterxml.jackson.databind.ObjectMapper;
import models.DictionaryDefinition;
import org.apache.commons.io.IOUtils;
import org.apache.http.HttpEntity;
import org.apache.http.HttpResponse;
import org.apache.http.client.HttpClient;
import org.apache.http.client.methods.HttpUriRequest;
import org.junit.jupiter.api.BeforeEach;
import org.junit.jupiter.api.Test;
import org.mockito.Mockito;

import java.io.IOException;

import static org.mockito.ArgumentMatchers.any;
import static org.mockito.Mockito.when;

public class MerriamWebsterClientTest {

    final ObjectMapper objectMapper = new ObjectMapper();
    final String apiKey = "apiKey";
    final String sampleResponse = "[{\"meta\":{\"id\":\"business\",\"uuid\":\"0b12fbd8-4aac-4933-87c4-fccda9b8c892\",\"sort\":\"020503900\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business\",\"businesses\",\"stage business\"],\"offensive\":false},\"hwi\":{\"hw\":\"busi*ness\",\"prs\":[{\"mw\":\"\\u02c8biz-n\\u0259s\",\"sound\":{\"audio\":\"busine07\",\"ref\":\"c\",\"stat\":\"1\"}},{\"mw\":\"-n\\u0259z\"},{\"l\":\"Southern also\",\"mw\":\"\\u02c8bid-\",\"sound\":{\"audio\":\"busine01\",\"ref\":\"c\",\"stat\":\"1\"}}]},\"fl\":\"noun\",\"lbs\":[\"often attributive\"],\"def\":[{\"sseq\":[[[\"sense\",{\"sn\":\"1 a\",\"dt\":[[\"text\",\"{bc}a usually commercial or {d_link|mercantile|mercantile} activity engaged in as a means of livelihood {bc}{sx|trade||}, {sx|line||} \"],[\"vis\",[{\"t\":\"in the restaurant {wi}business{\\/wi}\"}]]]}],[\"sense\",{\"sn\":\"b\",\"dt\":[[\"text\",\"{bc}a commercial or sometimes an industrial enterprise\"]],\"sdsense\":{\"sd\":\"also\",\"dt\":[[\"text\",\"{bc}such enterprises \"],[\"vis\",[{\"t\":\"the {wi}business{\\/wi} district\"}]]]}}],[\"sense\",{\"sn\":\"c\",\"dt\":[[\"text\",\"{bc}{d_link|dealings|dealing} or transactions especially of an economic nature {bc}{sx|patronage||} \"],[\"vis\",[{\"t\":\"took their {wi}business{\\/wi} elsewhere\"}]]]}]],[[\"sense\",{\"sn\":\"2 a\",\"dt\":[[\"text\",\"{bc}{sx|role||}, {sx|function||} \"],[\"vis\",[{\"t\":\"how the human mind went about its {wi}business{\\/wi} of learning\",\"aq\":{\"auth\":\"H. A. Overstreet\"}}]]]}],[\"sense\",{\"sn\":\"b\",\"dt\":[[\"text\",\"{bc}an immediate task or {d_link|objective|objective:2} {bc}{sx|mission||} \"],[\"vis\",[{\"t\":\"what is your {wi}business{\\/wi} here\"}]]]}],[\"sense\",{\"sn\":\"c\",\"dt\":[[\"text\",\"{bc}a particular field of endeavor \"],[\"vis\",[{\"t\":\"the best in the {wi}business{\\/wi}\"}]]]}]],[[\"sense\",{\"sn\":\"3\",\"dt\":[[\"text\",\"{bc}{sx|affair||}, {sx|matter||} \"],[\"vis\",[{\"t\":\"the whole {wi}business{\\/wi} got out of hand\"},{\"t\":\"{wi}business{\\/wi} as usual\"}]]]}]],[[\"sense\",{\"sn\":\"4 a\",\"dt\":[[\"text\",\"{bc}personal concern \"],[\"vis\",[{\"t\":\"none of your {wi}business{\\/wi}\"}]]]}],[\"sense\",{\"sn\":\"b\",\"dt\":[[\"text\",\"{bc}{sx|right||} \"],[\"vis\",[{\"t\":\"you have no {wi}business{\\/wi} speaking to me that way\"}]]]}]],[[\"sense\",{\"sn\":\"5 a\",\"dt\":[[\"text\",\"{bc}serious activity requiring time and effort and usually the avoidance of distractions \"],[\"vis\",[{\"t\":\"got down to {wi}business{\\/wi}\"}]]]}],[\"sense\",{\"sn\":\"b\",\"dt\":[[\"text\",\"{bc}maximum effort\"]]}]],[[\"sense\",{\"sn\":\"6\",\"dt\":[[\"text\",\"{bc}{sx|creation||}, {sx|concoction||}\"]]}]],[[\"sense\",{\"sn\":\"7\",\"dt\":[[\"text\",\"{bc}movement or action (such as lighting a cigarette) by an actor intended especially to establish {d_link|atmosphere|atmosphere}, reveal character, or explain a situation \"],[\"ca\",{\"intro\":\"called also\",\"cats\":[{\"cat\":\"stage business\"}]}]]}]],[[\"sense\",{\"sn\":\"8 a\",\"dt\":[[\"text\",\"{bc}a damaging assault\"]]}],[\"sense\",{\"sn\":\"b\",\"dt\":[[\"text\",\"{bc}{sx|rebuke||}, {sx|tongue-lashing||}\"]]}],[\"sense\",{\"sn\":\"c\",\"dt\":[[\"text\",\"{bc}{sx|double cross||}\"]]}]],[[\"sense\",{\"sn\":\"9\",\"dt\":[[\"text\",\"{bc}a bowel movement \"],[\"uns\",[[[\"text\",\"used especially of pets\"]]]]]}]],[[\"sense\",{\"sn\":\"10\",\"sls\":[\"archaic\"],\"dt\":[[\"text\",\"{bc}purposeful activity {bc}{sx|busyness||}\"]]}]]]}],\"syns\":[{\"pl\":\"synonyms\",\"pt\":[[\"text\",\"{sc}business{\\/sc} {sc}commerce{\\/sc} {sc}trade{\\/sc} {sc}industry{\\/sc} {sc}traffic{\\/sc} mean activity concerned with the supplying and distribution of commodities. {sc}business{\\/sc} may be an inclusive term but specifically designates the activities of those engaged in the purchase or sale of commodities or in related financial transactions. {sc}commerce{\\/sc} and {sc}trade{\\/sc} imply the exchange and transportation of commodities. {sc}industry{\\/sc} applies to the producing of commodities, especially by manufacturing or processing, usually on a large scale. {sc}traffic{\\/sc} applies to the operation and functioning of public carriers of goods and persons.\"]],\"sarefs\":[\"work\"]}],\"quotes\":[{\"t\":\"Lancaster and Columbia have plenty of history apart from the Civil War, of course. For example, Lancaster was home to F. W. Woolworth\\u0027s first successful 5\\u002610 and Milton S. Hershey\\u0027s first successful candy {qword}business{\\/qword}.\",\"aq\":{\"source\":\"{it}Lancaster New Era{\\/it}\",\"aqdate\":\"2 July 1996\"}},{\"t\":\"Such high attrition means that most of the dot-coms here today will be gone tomorrow. The {qword}business{\\/qword} environment is already harsh, and competition is growing.\",\"aq\":{\"auth\":\"Ann Thayer\",\"source\":\"{it}Chemical \\u0026 Engineering News{\\/it}\",\"aqdate\":\"5 June 2000\"}},{\"t\":\"The Sun may never set, but air temperatures can plummet to -4 degrees Fahrenheit, and blinding snowstorms appear without warning. Sunbathing here can be risky {qword}business{\\/qword}: even huddled in our parkas and boots, the members of our expedition live under the constant threat of frostbite and hypothermia.\",\"aq\":{\"auth\":\"Terrie M. Williams\",\"source\":\"{it}Natural History{\\/it}\",\"aqdate\":\"October 2003\"}},{\"t\":\"{it}Forever Odd{\\/it} is a direct sequel to 2003\\u0027s {it}Odd Thomas{\\/it}, the book in which we were introduced to the title character, a young man who can see the dead. They can\\u0027t talk to him, but they can nudge him in the direction they want, which is usually to help them tidy up some unfinished {qword}business{\\/qword} from when they were alive.\",\"aq\":{\"auth\":\"Charles De Lint\",\"source\":\"{it}Fantasy \\u0026 Science Fiction{\\/it}\",\"aqdate\":\"May 2006\"}}],\"et\":[[\"text\",\"Middle English {it}bisynesse{\\/it}, from {it}bisy{\\/it} busy + {it}-nesse{\\/it} -ness\"]],\"date\":\"14th century{ds||10||}\",\"shortdef\":[\"a usually commercial or mercantile activity engaged in as a means of livelihood : trade, line\",\"a commercial or sometimes an industrial enterprise; also : such enterprises\",\"dealings or transactions especially of an economic nature : patronage\"]},{\"meta\":{\"id\":\"business administration\",\"uuid\":\"b9de07b0-c15c-4daf-8a7d-8e3d1eb75cf2\",\"sort\":\"020504000\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business administration\"],\"offensive\":false},\"hwi\":{\"hw\":\"business administration\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a program of studies in a college or university providing general knowledge of business principles and practices\"]]}]]]}],\"date\":\"1904\",\"shortdef\":[\"a program of studies in a college or university providing general knowledge of business principles and practices\"]},{\"meta\":{\"id\":\"business card\",\"uuid\":\"c5a81746-7bd6-469d-9fe1-cde106cb36a8\",\"sort\":\"020504100\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business card\",\"business cards\"],\"offensive\":false},\"hwi\":{\"hw\":\"business card\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a small card bearing information (such as name and address) about a business or business representative\"]]}]]]}],\"date\":\"1821\",\"shortdef\":[\"a small card bearing information (such as name and address) about a business or business representative\"]},{\"meta\":{\"id\":\"business class\",\"uuid\":\"3b4e1639-8d01-4e37-a1b7-20acb1d538b3\",\"sort\":\"020504200\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business class\"],\"offensive\":false},\"hwi\":{\"hw\":\"business class\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a class of air transportation at a fare lower than first class and higher than coach\"]]}]]]}],\"date\":\"1962\",\"shortdef\":[\"a class of air transportation at a fare lower than first class and higher than coach\"]},{\"meta\":{\"id\":\"business cycle\",\"uuid\":\"42159826-bbf6-4bfc-9cfb-3259fd627a90\",\"sort\":\"020504300\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business cycle\",\"business cycles\"],\"offensive\":false},\"hwi\":{\"hw\":\"business cycle\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a cycle of economic activity usually consisting of recession, recovery, growth, and decline\"]]}]]]}],\"date\":\"1858\",\"shortdef\":[\"a cycle of economic activity usually consisting of recession, recovery, growth, and decline\"]},{\"meta\":{\"id\":\"business end\",\"uuid\":\"ac43c880-5128-4b0c-b780-3b8a36fcc0f6\",\"sort\":\"020504400\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business end\",\"business ends\"],\"offensive\":false},\"hwi\":{\"hw\":\"business end\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}the end with, from, or through which a thing\\u0027s function is fulfilled \"],[\"vis\",[{\"t\":\"the {it}business end{\\/it} of a revolver\"}]]]}]]]}],\"date\":\"1840\",\"shortdef\":[\"the end with, from, or through which a thing\\u0027s function is fulfilled\"]},{\"meta\":{\"id\":\"business suit\",\"uuid\":\"60672b86-6265-437f-a7ab-7ed10a5ea7e1\",\"sort\":\"020504900\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business suit\",\"business suits\"],\"offensive\":false},\"hwi\":{\"hw\":\"business suit\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a suit consisting of matching coat and trousers or coat and skirt and sometimes a vest\"]]}]]]}],\"date\":\"1854\",\"shortdef\":[\"a suit consisting of matching coat and trousers or coat and skirt and sometimes a vest\"]},{\"meta\":{\"id\":\"business-to-business\",\"uuid\":\"df0133d5-4846-42b6-85db-0cd007b53007\",\"sort\":\"020504950\",\"src\":\"collegiate\",\"section\":\"alpha\",\"stems\":[\"business-to-business\"],\"offensive\":false},\"hwi\":{\"hw\":\"busi*ness-to-busi*ness\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}a sector of business activity that focuses on commerce performed between businesses rather than between a business and a consumer \"],[\"vis\",[{\"t\":\"a company that specializes in {wi}business-to-business{\\/wi}\"},{\"t\":\"{wi}Business-to-business{\\/wi}, the sale of goods and services to other companies rather than to the public, has flourished for centuries.\",\"aq\":{\"auth\":\"Joanne Legomsky\"}}]],[\"uns\",[[[\"text\",\"usually used before another noun \"],[\"vis\",[{\"t\":\"{wi}Business-to-business{\\/wi} sales rose 4.4% from a year earlier, but retail sales increased less than 1%.\",\"aq\":{\"source\":\"{it}The Wall Street Journal{\\/it}\"}},{\"t\":\"{wi}business-to-business{\\/wi} companies\"},{\"t\":\"the {wi}business-to-business{\\/wi} market\"}]]]]],[\"uns\",[[[\"text\",\"abbreviation {it}B2B{\\/it}\"]]]]]}]]]}],\"date\":\"1979\",\"shortdef\":[\"a sector of business activity that focuses on commerce performed between businesses rather than between a business and a consumer \\u2014usually used before another noun \\u2014abbreviation B2B\"]},{\"meta\":{\"id\":\"business as usual\",\"uuid\":\"2ad99d75-31af-45c6-a940-ba7fe6af478b\",\"sort\":\"3002553000\",\"src\":\"ld\",\"section\":\"idioms\",\"stems\":[\"business as usual\"],\"offensive\":false},\"hwi\":{\"hw\":\"business as usual\"},\"fl\":\"idiom\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"uns\",[[[\"text\",\"used to say that something is working or continuing in the normal or usual way \"],[\"vis\",[{\"t\":\"Much of the town lost electricity in the storm, but for people with generators it was {it}business as usual{\\/it}.\"},{\"t\":\"As the election nears, both political parties continue to blame each other for all the city\\u0027s problems. In other words, it\\u0027s {it}business as usual{\\/it}.\"}]]]]]]}]]]}],\"shortdef\":[\"\\u2014used to say that something is working or continuing in the normal or usual way\"]},{\"meta\":{\"id\":\"business community\",\"uuid\":\"8418e4a8-1bdc-4c90-938f-1c80bc8ac25a\",\"sort\":\"3002556000\",\"src\":\"ld\",\"section\":\"idioms\",\"stems\":[\"business community\"],\"offensive\":false},\"hwi\":{\"hw\":\"business community\"},\"fl\":\"noun\",\"def\":[{\"sseq\":[[[\"sense\",{\"dt\":[[\"text\",\"{bc}the people involved in the upper levels of businesses\"]]}]]]}],\"shortdef\":[\"the people involved in the upper levels of businesses\"]}]";
    final HttpClient httpClient = Mockito.mock(HttpClient.class);
    final HttpResponse httpResponse = Mockito.mock(HttpResponse.class);
    final MerriamWebsterClient merriamWebsterClient = new MerriamWebsterClient(
            httpClient,
            apiKey,
            objectMapper
    );
    final HttpEntity httpEntity = Mockito.mock(HttpEntity.class);

    @BeforeEach
    void setup() throws IOException {
        when(httpResponse.getEntity())
                .thenReturn(httpEntity);
        when(httpEntity.getContent())
                .thenReturn(IOUtils.toInputStream(sampleResponse));
        when(httpClient.execute(any(HttpUriRequest.class)))
                .thenReturn(httpResponse);
    }

    @Test
    void test() throws IOException {
        DictionaryDefinition test = merriamWebsterClient.getDefinition("test");
        System.out.println(test);
    }
}